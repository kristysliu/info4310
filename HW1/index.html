<!DOCTYPE html>
<html lang="en">
  <head>
    <title>INFO 4310 - Sept-21</title>
    <meta charset="utf-8" />
    <!-- <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script> -->
    <script src="https://d3js.org/d3.v5.min.js"></script>

  <!--
    <link rel="stylesheet" type="text/css" href="../css/normalize.css">
    <link rel="stylesheet" type="text/css" href="../css/skeleton.css">
    <link rel="stylesheet" type="text/css" href="../css/custom-style.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
     -->
     <style>

     #ScatterVis {
       float:left;
       margin-bottom: 20px;
       margin-right: 20px;
       margin-left: 10px;
      }

     #PopUpInfo {
      height:400px;
      width:400px;
      padding: 20px 30px 20px 20px;
      }
      #PopUpInfo h5 {
      margin:0;
      padding:0;
      }
     </style>

  </head>
  <body>
    <div class="container larger">
      <h1>INFO 4310 HW 1</h1>
      <h3>Kristy Liu (kl768)</h3>
      <div id="PopUpInfo"></div>
      <svg id="ScatterVis" width="2000" height="700" style="float:left;">
        <rect height="700" width="2000" style="fill:lightgrey;stroke-width:3;stroke:rgb(0,0,0)" />
      </svg>

      <script>
        const scatter = d3.select("svg#ScatterVis");
        const width = scatter.attr("width");
        const height = scatter.attr("height");
        const margin = {top: 15, right: 15, bottom: 70, left: 180};
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        let annotations = scatter.append("g").attr("id","annotations");
        let chartArea = scatter.append("g").attr("id","points")
                        .attr("transform","translate("+margin.left+","+margin.top+")");
        const loadScatter = async function() {
          let data = await d3.csv("../TreeDataFiltered.csv", d3.autoType )
          let qCaretaker = []
          let qLegalStatus = []
          data.forEach( d => {
            var strings = String(d['qSpecies']).split(" :: ");
            d['latin_name'] = String(strings[0]);
            d['common_name'] = String(strings[1]);
            d['DBH'] = parseInt(d['DBH']);
            // qCaretaker.push(d['qCaretaker']);
            qLegalStatus.push(d['qLegalStatus']);
          });
          let qLegalStatus_unique = new Set(qLegalStatus)
          let qLegalStatus_unique_length = new Set(qLegalStatus).size
          // const caretakerExtent = [0,parseInt(qCaretaker_unique_length)]
          // const caretakerScale = d3.scaleLinear().domain(caretakerExtent).range([0, chartWidth]);
          const caretakerScale = d3.scaleBand()
          .domain(data.map(function(d) {
            return d['qCaretaker'];
          })).range([chartHeight, 0]);
          const dbhExtent = d3.extent(data, d => d['DBH']);
          const dbhScale = d3.scaleLog().domain(dbhExtent).range([0, chartWidth]);
          // const legalExtent = [0,parseInt(qLegalStatus_unique_length)]
          const legalstatusScale = d3.scaleOrdinal()
          .domain(qLegalStatus_unique)
          .range(['#1b70fc','#a946aa','#24c9d7','#ff7b91','#8c46fc','#f3db1d','#e8ac48','#22e67a','#9a634a','#698ffc']);
          let leftAxis = d3.axisLeft(caretakerScale)
          let leftGridlines = d3.axisLeft(caretakerScale)
                                .tickSize(-chartWidth)
                                .tickFormat("")
          let bottomAxis = d3.axisBottom(dbhScale).tickFormat(d3.format("d"))
          let bottomGridlines = d3.axisBottom(dbhScale)
                                .tickSize(-chartHeight)
                                .tickFormat("")
          annotations.append("g")
            .attr("class", "y axis")
            .attr("transform","translate("+(margin.left-10)+","+margin.top+")")
            .call(leftAxis)
          annotations.append("g")
            .attr("class", "y gridlines")
            .attr("transform","translate("+(margin.left-10)+","+margin.top+")")
            .call(leftGridlines);
          annotations.append("g")
            .attr("class", "x axis")
            .attr("transform","translate("+(margin.left-10)+","+(chartHeight+margin.top)+")")
            .call(bottomAxis)
            .selectAll("text")
            .attr("y", 15)
            .attr("x", 0)
            .style("text-anchor", "middle");
          annotations.append("g")
            .attr("class", "x gridlines")
            .attr("transform","translate("+(margin.left-10)+","+(chartHeight+margin.top)+")")
            .call(bottomGridlines);

          let circles = chartArea.selectAll("circle.point").data(data)
                                  .join(enter => enter.append("circle")
                                                      .attr("class","point")
                                                    )
                                  .attr("cy", d => caretakerScale(d['qCaretaker']))
                                  .attr("cx", d => dbhScale(d['DBH']+1))
                                  // .attr("r", d => imdbScale(d['imdb_rating']))
                                  .attr("r", 5)
                                  .attr("fill", d => legalstatusScale(d['qLegalStatus']) )
                                  .attr("stroke-width", 1)
                                  // .attr("label", d => d["common_name"])
                                  // .attr("legalstatus", d => d["qLegalStatus"])
                                  .attr("transform","translate("+(-10)+","+(15)+")");


        circles.on("mouseover", function(event, d) {
          d3.select(this)
            .transition().duration(100)
            .attr("stroke","black")
            .attr("stroke-width", 3)
            .attr("r", 7)
        });

        circles.on("mouseout", function(event, d) {

          d3.select(this)
            .transition().duration(100)
            .attr("stroke","")
            .attr("stroke-width", 1)
            .attr("r", 5)
        });

        let popupHeader = d3.select("#PopUpInfo").append("h5");
        let table = d3.select("#PopUpInfo").append("table");

        function updatePanel(row) {


        }

        // Creating an interactive surface for better events
        let surface = scatter.append("g")
                             .style("pointer-events","all")
                             .attr("transform","translate("+margin.left+","+margin.top+")")
        surface.append("rect")
                  .attr("width",chartWidth/2)
                  .attr("height",chartHeight/4)
                  .attr("x",1000)
                  .attr("y",0)
                  .attr("fill","blue");

        }
        loadScatter();

        // function lighten(color) {
        //
        //     let hclColor = d3.hcl(color);
        //     let luma = Math.min(130, hclColor.l + 30);
        //     return d3.rgb( d3.hcl( hclColor.h, hclColor.c, luma ) );
        //
        // }
      </script>
    </div>
  </body>
</html>
